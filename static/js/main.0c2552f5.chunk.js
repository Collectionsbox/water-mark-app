(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,i){e.exports={container:"Edit_container__11bLB",trackView:"Edit_trackView__3RiRA",editContent:"Edit_editContent__1mKRe",edit:"Edit_edit__3xV1N"}},21:function(e,t,i){e.exports={file:"FileInput_file__1WOg1"}},23:function(e,t,i){e.exports=i(38)},28:function(e,t,i){},29:function(e,t,i){},30:function(e,t,i){},38:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),r=i(19),c=i.n(r),o=(i(28),i(1)),s=i(2),h=i(5),l=i(3),u=i(4),d=(i(29),i(30),i(8)),v=i(6),p=i(13),f="ADD_EDIT_IMAGE",y="ADD_WM_IMAGE",k="INIT_EDIT_VIEW",g="REDRAW",w="EDIT_DROP",m="EDIT_DRAG",R="EDIT_UP",b="EDIT_OVER",E="DELETE_SELECTED_SPRITE",x="EXPORT",I={getImageInfo:function(e,t,i){var a=new Image;a.onload=function(){t({width:a.width,height:a.height,image:a})},a.onerror=function(){alert("Not Support!")},a.src=e},isPointInRect:function(e,t){var i=t.x,a=t.y,n=t.width,r=t.height;return e.x>=i&&e.x<=i+n&&e.y>=a&&e.y<=a+r},addEvent:function(e,t,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.addEventListener(t,i,a)},removeEvent:function(e,t,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.removeEventListener(t,i,a)}},N=function(){function e(){Object(o.a)(this,e),this.element=null,this.trackLineColor="#ee3960",this.trackLineOverColor="#5E5E5E",this.trackLineWidth=2,this.trackNodeRadius=8,this.trackNodeColor="#AEAEAE",this.trackNodeActiveColor="#26ADEE",this.trackNodeCollection=[],this.init()}return Object(s.a)(e,[{key:"init",value:function(){for(var t in this.element=document.createElement("div"),this.element.style.setProperty("border",this.trackLineWidth+"px dashed "+this.trackLineColor),this.element.style.setProperty("position","absolute"),e.Track_NODE){var i=e.Track_NODE[t];if(i>=0&&i<=7){var a=null;switch(i){case 0:a=this.createTrackNode({x:0,y:0});break;case 1:a=this.createTrackNode({x:"50%",y:0});break;case 2:a=this.createTrackNode({x:"100%",y:0});break;case 3:a=this.createTrackNode({x:"100%",y:"50%"});break;case 4:a=this.createTrackNode({x:"100%",y:"100%"});break;case 5:a=this.createTrackNode({x:"50%",y:"100%"});break;case 6:a=this.createTrackNode({x:0,y:"100%"});break;case 7:a=this.createTrackNode({x:0,y:"50%"})}this.element.appendChild(a),this.trackNodeCollection.push(a)}}}},{key:"createTrackNode",value:function(e){var t=e.x,i=e.y,a=document.createElement("div");return a.style.setProperty("border-radius","50%"),a.style.setProperty("border","1px solid #000000"),a.style.setProperty("width",2*this.trackNodeRadius+"px"),a.style.setProperty("height",2*this.trackNodeRadius+"px"),a.style.setProperty("background-color",this.trackNodeColor),a.style.setProperty("position","absolute"),a.style.setProperty("left",t),a.style.setProperty("top",i),a.style.setProperty("transform","translate(-50%, -50%)"),a}},{key:"draw",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;e.appendChild(this.element);for(var r=0;r<this.trackNodeCollection.length;r++)this.trackNodeCollection[r].style.setProperty("display",a?"block":"none"),this.trackNodeCollection[r].style.setProperty("background-color",n===r?this.trackNodeActiveColor:this.trackNodeColor);var c=this.getRect(e,t),o=c.x,s=c.y,h=c.width,l=c.height;this.element.style.setProperty("border-color",a?this.trackLineColor:this.trackLineOverColor),this.element.style.setProperty("left",o+"px"),this.element.style.setProperty("top",s+"px"),this.element.style.setProperty("width",h+"px"),this.element.style.setProperty("height",l+"px"),this.element.style.setProperty("transform","rotate("+i+")")}},{key:"clear",value:function(){this.element.parentNode&&this.element.remove()}},{key:"nodePoint",value:function(e,t,i,a){var n=this.getRect(e,t),r=n.x,c=n.y,o=n.width,s=n.height;return this.pointInNode({x:r,y:c},a)?0:this.pointInNode({x:r+o/2,y:c},a)?1:this.pointInNode({x:r+o,y:c},a)?2:this.pointInNode({x:r+o,y:c+s/2},a)?3:this.pointInNode({x:r+o,y:c+s},a)?4:this.pointInNode({x:r+o/2,y:c+s},a)?5:this.pointInNode({x:r,y:c+s},a)?6:this.pointInNode({x:r,y:c+s/2},a)?7:I.isPointInRect(a,{x:r,y:c,width:o,height:s},a)?8:-1}},{key:"pointInNode",value:function(e,t){var i=e.x,a=e.y;return I.isPointInRect(t,{x:i-this.trackNodeRadius,y:a-this.trackNodeRadius,width:2*this.trackNodeRadius,height:2*this.trackNodeRadius})}},{key:"getRect",value:function(e,t){var i=t.x,a=t.y,n=t.w,r=t.h,c=e.getBoundingClientRect(),o=c.width,s=c.height;return{x:i*o,y:a*s,width:n*o,height:r*s}}}]),e}();N.Track_NODE={LEFT_TOP:0,CENTER_TOP:1,RIGHT_TOP:2,RIGHT_CENTER:3,RIGHT_BOTTOM:4,CENTER_BOTTOM:5,LEFT_BOTTOM:6,LEFT_CENTER:7,CENTER:8,NONE:-1};var C=N,O=function(){function e(){Object(o.a)(this,e),this.sprites=[],this.selectedIndex=-1,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.trackView=null,this.trackNode=-1}return Object(s.a)(e,[{key:"getCanvas",value:function(){return this.canvas}},{key:"getContext",value:function(){return this.context}},{key:"setSize",value:function(e){this.canvas.width=e.width,this.canvas.height=e.height}},{key:"getSize",value:function(){return{width:this.canvas.width,height:this.canvas.height}}},{key:"updateAllSpriteRelativeRect",value:function(e,t){this.sprites.forEach(function(i){var a=i.getRelativeRect(),n=a.w,r=a.h;i.updateRelativeRect(e,{width:n*t.width,height:r*t.height})})}},{key:"clear",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"draw",value:function(){var e=this;this.sprites.forEach(function(t){e.drawSprite(t)})}},{key:"drawSprite",value:function(e){e.draw(this.canvas)}},{key:"addSprite",value:function(e){this.sprites.push(e)}},{key:"deleteSpite",value:function(){this.sprites[this.selectedIndex].delete(),this.sprites.splice(this.selectedIndex,1)}},{key:"drop",value:function(e){this.selectedIndex=-1;for(var t=!1,i=this.sprites.length-1;i>-1;i--){var a=this.sprites[i];a.clearTrack(),t||(this.trackNode=a.trackNodePoint(this.trackView,e),-1!==this.trackNode&&(this.selectedIndex=i,t=!0))}t&&this.sprites[this.selectedIndex].drawTrack(this.trackView,!0,this.trackNode)}},{key:"dropUp",value:function(){this.trackNode=-1,-1!==this.selectedIndex&&this.sprites[this.selectedIndex].drawTrack(this.trackView,!0,this.trackNode)}},{key:"drag",value:function(e){if(-1!==this.selectedIndex){var t=this.getSize(),i=t.width,a=t.height,n={x:e.x/i,y:e.y/a},r=this.sprites[this.selectedIndex];this.trackNode===C.Track_NODE.CENTER?r.move(n):this.trackNode!==C.Track_NODE.NONE&&r.resize(this.trackNode,n),r.drawTrack(this.trackView,!0,this.trackNode)}}},{key:"mouseOver",value:function(e){var t=this,i=null,a=!1;this.sprites.forEach(function(e,i){i!==t.selectedIndex&&e.clearTrack()});for(var n=this.sprites.length-1;n>-1;n--){var r=this.sprites[n];if(this.trackNode=r.trackNodePoint(this.trackView,e),this.selectedIndex===n&&-1!==this.trackNode)break;a||-1===this.trackNode||(i=r,a=!0)}i&&i.drawTrack(this.trackView,!1,-1)}},{key:"initTrackView",value:function(e){this.trackView=e}}]),e}(),T=function(e){function t(e){var i;return Object(o.a)(this,t),(i=Object(h.a)(this,Object(l.a)(t).call(this,e))).blobUrl="",i.image=new Image,i}return Object(u.a)(t,e),Object(s.a)(t,[{key:"setSource",value:function(e,t,i){var a=this;this.blobUrl=e,this.image.addEventListener("load",function(){if(a.relativeRect){var e=a.image.clientWidth/a.image.clientHeight,i=a.relativeRect.h;a.relativeRect.h=a.relativeRect.w/e,a.relativeRect.y-=a.relativeRect.h-i}t&&t()}),this.image.addEventListener("error",function(){console.log("not support"),i&&i()}),this.image.src=this.blobUrl}},{key:"getSource",value:function(){return this.blobUrl}},{key:"draw",value:function(e){var t=e.width,i=e.height;this.relativeRect||this.initRelativeRect({width:t,height:i},{width:this.image.naturalWidth,height:this.image.naturalHeight});var a=e.getContext("2d"),n=this.relativeRect.x*t,r=this.relativeRect.y*i,c=this.relativeRect.w*t,o=this.relativeRect.h*i;a.drawImage(this.image,n,r,c,o)}}]),t}(function(){function e(){Object(o.a)(this,e),this.relativeRect=null,this.rotation=0,this.layerIndex=1,this.track=new C}return Object(s.a)(e,[{key:"getRelativeRect",value:function(){return this.relativeRect}},{key:"setRelativeRect",value:function(e){this.relativeRect=Object(p.a)({},e)}},{key:"clearRelativeRect",value:function(){this.relativeRect=null}},{key:"getRotation",value:function(){return this.rotation}},{key:"setRotation",value:function(e){this.rotation=e}},{key:"move",value:function(e){this.relativeRect.x+=e.x,this.relativeRect.y+=e.y}},{key:"resize",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=t.x,n=t.y,r=this.relativeRect.w/this.relativeRect.h,c=this.relativeRect.w,o=this.relativeRect.h;switch(e){case 0:var s=a<0||0===a&&n>0;i?(this.relativeRect.w+=s?Math.abs(a):-Math.abs(a),this.relativeRect.h=this.relativeRect.w/r):(this.relativeRect.w-=a,this.relativeRect.h-=n),this.relativeRect.x-=this.relativeRect.w-c,this.relativeRect.y-=this.relativeRect.h-o;break;case 1:this.relativeRect.h-=n,this.relativeRect.y+=n;break;case 2:var h=a>0||0===a&&n>0;i?(this.relativeRect.w+=h?Math.abs(a):-Math.abs(a),this.relativeRect.h=this.relativeRect.w/r):(this.relativeRect.w+=a,this.relativeRect.h-=n),this.relativeRect.y-=this.relativeRect.h-o;break;case 3:this.relativeRect.w+=a;break;case 4:var l=a>0||0===a&&n<0;i?(this.relativeRect.w+=l?Math.abs(a):-Math.abs(a),this.relativeRect.h=this.relativeRect.w/r):(this.relativeRect.w+=a,this.relativeRect.h+=n);break;case 5:this.relativeRect.h+=n;break;case 6:var u=a<0||0===a&&n<0;i?(this.relativeRect.w+=u?Math.abs(a):-Math.abs(a),this.relativeRect.h=this.relativeRect.w/r):(this.relativeRect.w-=a,this.relativeRect.h+=n),this.relativeRect.x+=a;break;case 7:this.relativeRect.w-=a,this.relativeRect.x+=a}}},{key:"draw",value:function(){}},{key:"getLayerIndex",value:function(){return this.layerIndex}},{key:"setLayerIndex",value:function(e){this.layerIndex=e}},{key:"initRelativeRect",value:function(e,t){var i=e.width,a=e.height;this.relativeRect={};var n=t.width/t.height;this.relativeRect.w=.5,this.relativeRect.h=i*this.relativeRect.w/n/a,this.relativeRect.x=(1-this.relativeRect.w)/2,this.relativeRect.y=(1-this.relativeRect.h)/2}},{key:"getRect",value:function(e){var t=this.relativeRect,i=t.x,a=t.y,n=t.w,r=t.h,c=e.width,o=e.height;return{x:i*c,y:a*o,width:n*c,height:r*o}}},{key:"drawTrack",value:function(e,t,i){this.track.draw(e,this.relativeRect,this.rotation,t,i)}},{key:"delete",value:function(){this.track.clear()}},{key:"clearTrack",value:function(){this.track.clear()}},{key:"trackNodePoint",value:function(e,t){return this.track.nodePoint(e,this.relativeRect,this.rotation,t)}},{key:"updateRelativeRect",value:function(e,t){var i=this.relativeRect,a=i.x,n=i.y,r=i.w,c={w:r},o=a+r/2,s=n+i.h/2,h=t.width/t.height;c.h=e.width*r/h/e.height,c.x=o-c.w/2,c.y=s-c.h/2,this.relativeRect=c}}]),e}()),j=(i(35),new O),D=null,_=function(e){(D=e).parentNode.appendChild(j.getCanvas())},P=function(e){j.initTrackView(e)},M=function(){j.draw()},L=function(e){j.updateAllSpriteRelativeRect(e,j.getSize()),j.setSize(e),j.clear(),j.draw()},S=function(e){var t=new T;t.setSource(e,function(){j.addSprite(t),j.drawSprite(t),j.draw()})},U=function(){j.deleteSpite(),j.clear(),j.draw()},V=function(e){j.drop(e)},A=function(){j.dropUp()},z=function(e){j.mouseOver(e)},W=function(e){j.clear(),j.drag(e),j.draw()},B=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),i=j.getSize(),a=i.width,n=i.height;e.width=a,e.height=n,t.drawImage(D,0,0,a,n),t.drawImage(j.getCanvas(),0,0,a,n),e.toBlob(function(e){var t=URL.createObjectURL(e),i=document.createElement("a");i.download="export.png",document.body.appendChild(i),i.href=t,i.click(),i.remove(),URL.revokeObjectURL(t)})},H={size:{width:500,height:500},editImage:""},G=Object(v.c)({edit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return _(t.canvas),P(t.trackView),e;case y:return S(t.blobUrl),e;case f:var i=t.editImageSize,a=i.width/i.height,n={};return a>1?(n.width=500,n.height=500/a):(n.height=500,n.width=500*a),L(n),Object(p.a)({},e,{editImage:t.blobUrl,size:n});case g:return M(),e;case w:return V(t.point),e;case m:return W(t.offset),e;case R:return A(),e;case b:return z(t.point),e;case E:return U(),e;case x:return B(),e;default:return e}}}),F=i(10),J=i.n(F),X=function(e){function t(e){var i;return Object(o.a)(this,t),(i=Object(h.a)(this,Object(l.a)(t).call(this,e))).mouseDown=function(e){i.isMouseDown=!0,i.point=i.getPoint(e),I.addEvent(document.body,"mouseup",i.mouseUp),i.props.mouseDownInCanvas(i.point)},i.mouseUp=function(e){i.isMouseDown=!1,I.removeEvent(document.body,"mouseup",i.mouseUp),i.props.mouseUpInCanvas()},i.mouseMove=function(e){var t=i.getPoint(e),a={x:t.x-i.point.x,y:t.y-i.point.y};i.isMouseDown?i.props.mouseMoveInCanvas(a):i.props.mouseOverInCanvas(t),i.point=t},i.keyDown=function(e){"Delete"===e.key&&i.props.deleteSelectedSprite()},i.getPoint=function(e){var t=i.editCanvas.getBoundingClientRect(),a=t.left,n=t.top;return{x:e.clientX-a,y:e.clientY-n}},i.drawEditImage=function(){var e=i.props.editImage,t=i.editCanvas.getContext("2d");I.getImageInfo(e,function(e){var a=e.image;t.drawImage(a,0,0,i.editCanvas.width,i.editCanvas.height),i.props.redraw()})},i.point={x:0,y:0},i.isMouseDown=!1,i}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.props.initEditView(this.editCanvas,this.trackView),I.addEvent(document.body,"mousemove",this.mouseMove),I.addEvent(document.body,"keydown",this.keyDown)}},{key:"componentWillMount",value:function(){I.removeEvent(document.body,"mousemove",this.mouseMove),I.removeEvent(document.body,"keydown",this.keyDown)}},{key:"componentDidUpdate",value:function(e,t,i){var a=this.props.editImage;a&&a!==e.editImage&&this.drawEditImage()}},{key:"render",value:function(){var e=this,t=this.props.size;return n.a.createElement("div",{style:{width:t.width,height:t.height},ref:function(t){return e.container=t},onMouseDown:this.mouseDown,className:J.a.container},n.a.createElement("div",{className:J.a.editContent,style:{width:t.width,height:t.height}},n.a.createElement("canvas",{ref:function(t){return e.editCanvas=t},style:{width:t.width,height:t.height},className:J.a.edit,width:t.width,height:t.height})),n.a.createElement("div",{ref:function(t){return e.trackView=t},className:J.a.trackView}))}}]),t}(a.Component),K=Object(d.b)(function(e){return{size:e.edit.size,editImage:e.edit.editImage}},function(e){return{initEditView:function(t,i){e(function(e,t){return{type:k,canvas:e,trackView:t}}(t,i))},redraw:function(){e({type:g})},mouseDownInCanvas:function(t){e(function(e){return{type:w,point:e}}(t))},mouseMoveInCanvas:function(t){e(function(e){return{type:m,offset:e}}(t))},mouseUpInCanvas:function(){e({type:R})},mouseOverInCanvas:function(t){e(function(e){return{type:b,point:e}}(t))},deleteSelectedSprite:function(){e({type:E})}}})(X),Y=i(21),$=i.n(Y),q=function(e){function t(){var e,i;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(i=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).triggerClick=function(){i.input.click()},i}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,i=t.accept,a=t.dataChange;return n.a.createElement("input",{ref:function(t){return e.input=t},className:$.a.file,onChange:a,type:"file",accept:i})}}]),t}(a.Component),Q=function(e){function t(){var e,i;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(i=Object(h.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).bgHandleClick=function(){i.bgImage.triggerClick()},i.wmHandleClick=function(){i.wmImage.triggerClick()},i.bgDataChange=function(e){e.target.files[0]&&i.props.addEditImage(URL.createObjectURL(e.target.files[0]))},i.wmDataChange=function(e){e.target.files[0]&&i.props.addWMImage(URL.createObjectURL(e.target.files[0]))},i.export=function(){i.props.exportImage()},i}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(a.Fragment,null,n.a.createElement("button",{onClick:this.bgHandleClick},"\u6dfb\u52a0\u5716\u7247"),n.a.createElement("button",{onClick:this.wmHandleClick},"\u6dfb\u52a0\u5716\u7247\u6c34\u5370"),n.a.createElement("button",{onClick:this.export},"\u5bfc\u51fa"),n.a.createElement(q,{ref:function(t){return e.bgImage=t},accept:"image/*",dataChange:this.bgDataChange}),n.a.createElement(q,{ref:function(t){return e.wmImage=t},accept:"image/*",dataChange:this.wmDataChange}))}}]),t}(a.Component),Z=Object(d.b)(function(e){return{}},function(e){return{addEditImage:function(t){var i;e((i=t,function(e,t){I.getImageInfo(i,function(t){var a=t.width,n=t.height;e({type:f,blobUrl:i,editImageSize:{width:a,height:n}})})}))},addWMImage:function(t){e({type:y,blobUrl:t})},exportImage:function(){e({type:x})}}})(Q),ee=i(22),te=Object(v.d)(G,Object(v.a)(ee.a)),ie=function(e){function t(){return Object(o.a)(this,t),Object(h.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return n.a.createElement(d.a,{store:te},n.a.createElement("div",{className:"App"},n.a.createElement(K,null),n.a.createElement(Z,null)))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[23,1,2]]]);
//# sourceMappingURL=main.0c2552f5.chunk.js.map